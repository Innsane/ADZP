@page "{handler?}"
@model AlgorytmDobieraniaZasobowProdukcyjnych.Pages.TreeViewModel
@{
    ViewData["Title"] = "TreeView";
}
@using AlgorytmDobieraniaZasobowProdukcyjnych.Models;
@section Scripts
{
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>

    <script type="text/javascript">
    var tableNameOld = "WiertlaDAT";
    var table = $("#dataTable");

$(document).ready(function () {
    $('#treeView').jstree({
        plugins: [ "changed" ],
        core: {
            "data": @Html.Raw(ViewData["json"]),
        }
    });
    table = $('#dataTable').DataTable({
        processing: true,
    });
    //table.DataTable().draw();


    $.getJSON(`TreeView/DataToTable`, function (data) {
        alert(JSON.stringify(data));
        var table1 = $('#dataTable1').DataTable({
            processing: true,
            data: data.data,
            columns: data.columns,

            //    [
            //    { title: "Oznaczenie", data: "oznaczenie" },
            //    { title: "Producent", data: "producent" },
            //    { title: "OznPn", data: "oznPn" },
            //    { title: "Typ", data: "typ" },
            //    { title: "Technologia", data: "technologia" },
            //    { title: "NormaPn", data: "normaPn" },
            //    { title: "NormaEn", data: "normaEn" },
            //    { title: "Material", data: "material" },
            //    { title: "KatR", data: "katR" },
            //    { title: "Opis", data: "opis" },
            //    { title: "Kod", data: "kod" },
            //    { title: "Obraz", data: "obraz" },
            //    { title: "Rys2D", data: "rys2D" },
            //    { title: "Mod3D", data: "mod3D" }
            //],
            autoWidth: true
        });
    });

    //write name of Image to Input
    $('#dataTable tbody').on('click', 'tr', function () {
        var celltext = $(this).data('obraz');
        $("#cellName").val(celltext);
        //alert('You clicked on ' + $(this).data('obraz') + '\'s row');
    });

    //display Modal with Image
    $('#myModal').on('click', function () {
        var cellname = document.getElementById("cellName").value;
        $('.modal-body').load(`/treeview/modalimage?path=${cellname}`);
    });


    //filter table based on node data in TreeView
    $("#treeView").on("changed.jstree", function (e, data) {
        $("#lb").text(data.node.id);
        $("#tableName").val(data.node.data[0]);
        var tableName = document.getElementById("tableName").value;

        if (tableName == "" || tableName == tableNameOld) {
            $('#dataTable').DataTable().column('#kod').search(data.node.id).draw();
            console.log("ID: " + data.node.id);
        }
        else {
            //table.destroy();
            //$("#dataTable").empty();
            $('#dt').load(`/treeview/datatable?tablename=${tableName}`, function (response, status, xhr) {
                if (status == "success") {
                    $('#dataTable').DataTable().column('#kod').search(data.node.id).draw();
                    //write name of Image to Input
                    $('#dataTable tbody').on('click', 'tr', function () {
                        var celltext = $(this).data('obraz');
                        $("#cellName").val(celltext);
                        //alert('You clicked on ' + $(this).data('obraz') + '\'s row');
                    });

                    //display Modal with Image
                    $('#myModal').on('click', function () {
                        var cellname = document.getElementById("cellName").value;
                        $('.modal-body').load(`/treeview/modalimage?path=${cellname}`);
                    });
                }
            }
            );
            console.log("ID: " + data.node.id);
        }
        tableNameOld = tableName;
    });
});




    </script>
}
<label>Symbol wybranego zasobu: </label>
<label id="lb"> </label>


<form id="form" method="post">
    <select name="picked" asp-for="Picked">
        @foreach (var resource in Model.Resources)
        {
            <option id="item" value="@resource.KeyId">@resource.Nazwa</option>
        }
    </select>
    <input type="submit" id="submitName" value="Display" />
</form>
<br />
<label>Nazwa wybranej tablicy: </label>
<input type="text" id="tableName" disabled />
<button id="tbButton">Load table</button>
<br />
<label>Obraz wybranej komorki: </label>
<input id="cellName" type="text" disabled />

<button id="myModal" type="button" class="btn btn-primary" data-toggle="modal" data-target="#imgModal">
    Obrazek
</button>


<div class="row">
    <div style="font-size: 12px"
         id="treeView" class="col-3">
    </div>

    <div id="dt" class="col-9">
        <partial name="_DataTable" model="Model.DataTablePartial" />
    </div>
</div>

<div id="imgModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Nazwa narzedzia</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>













