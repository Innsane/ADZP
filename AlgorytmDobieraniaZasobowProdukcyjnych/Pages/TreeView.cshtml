@page "{handler?}"
@model AlgorytmDobieraniaZasobowProdukcyjnych.Pages.TreeViewModel
@{
    ViewData["Title"] = "TreeView";
}

@using AlgorytmDobieraniaZasobowProdukcyjnych.Models;

@section Scripts
{
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>

    <script type="text/javascript">
    var tableNameOld = "WiertlaDAT";
    var table = $("#dataTable");

$(document).ready(function () {
    $('#treeView').jstree({
        plugins: [ "changed" ],
        core: {
            "data": @Html.Raw(ViewData["json"]),
        }

    });
    table = $('#dataTable').DataTable({
        processing: true,
        deferRender: true,
    });



    //write name of Image to Input
    $('#dataTable tbody').on('click', 'tr', function () {
        var celltext = $(this).data('obraz');
        $("#cellName").val(celltext);
        //alert('You clicked on ' + $(this).data('obraz') + '\'s row');
    });

    //display Modal with Image
    $('#myModal').on('click', function () {
        var cellname = document.getElementById("cellName").value;
        $('.modal-body').load(`/treeview/modalimage?path=${cellname}`);
    });


    //filter table based on node data in TreeView
    $("#treeView").on("changed.jstree", function (e, data) {
        $("#lb").val(data.node.id);
        $("#tableName").val(data.node.data[0]);
        var tableName = document.getElementById("tableName").value;

        if (tableName == "" || tableName == tableNameOld) {
            $('#dataTable').DataTable().column('#kod').search(data.node.id).draw();
            console.log("ID: " + data.node.id);
        }
        else {
            $('#dt').load(`/treeview/datatable?tablename=${tableName}`, function (response, status, xhr) {
                if (status == "success") {
                    $('#dataTable').DataTable().column('#kod').search(data.node.id).draw();
                    //write name of Image to Input
                    $('#dataTable tbody').on('click', 'tr', function () {
                        var celltext = $(this).data('obraz');
                        $("#cellName").val(celltext);
                        //alert('You clicked on ' + $(this).data('obraz') + '\'s row');
                    });
                }
            }
            );
            console.log("ID: " + data.node.id);
        }
        tableNameOld = tableName;
    });
});




    </script>
}

<div class="input-group mb-2 col-7">
    <div class="input-group-prepend">
        <span class="input-group-text">Symbol wybranego zasobu: </span>
    </div>
    <input class="form-control" id="lb" disabled>
</div>
<div class="input-group mb-2 col-7">
    <div class="input-group-prepend">
        <span class="input-group-text">Nazwa wybranej tabeli: </span>
    </div>
    <input class="form-control" type="text" id="tableName" disabled />
</div>
<div class="input-group mb-2 col-7">
    <div class="input-group-prepend">
        <label class="input-group-text">Nazwa obrazu dla wybranego narzędzia: </label>
    </div>
    <input id="cellName" type="text" disabled />
    <div class="input-group-append">
        <button id="myModal" type="button" class="btn btn-primary" data-toggle="modal" data-target="#imgModal">
            Pokaż
        </button>    
    </div>
    
</div>

<form id="form" method="post">
    <div class="row">
        <div class="input-group col-7">
            <div class="input-group-prepend">
                <label class="input-group-text" for="picked">Klasa wybranych zasobów produkcyjnych: </label>
            </div>
            <select id="picked" class="custom-select" name="picked" asp-for="Picked">
                @foreach (var resource in Model.Resources)
                {
                    <option id="item" value="@resource.KeyId">@resource.Nazwa</option>
                }
            </select>
            <div class="input-group-append">
                <input class="btn btn-primary" type="submit" id="submitName" value="OK" />
            </div>
        </div>
    </div>
</form>



<div class="row">
    <div style="        font-size: 12px;
        white-space: normal !important;
        height: auto;
        padding: 1px 2px;
        min-width:280px;" id="treeView" class="col-3">
    </div>

    <div id="dt" class="col-9">
        <partial name="_DataTable" model="Model.DataTablePartial" />
    </div>
</div>

<div id="imgModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Nazwa narzedzia</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>













